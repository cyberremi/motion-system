<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Camera Sender</title>
</head>
<body>
  <h2>Camera Sender</h2>
  <video id="preview" autoplay playsinline></video>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const pc = new RTCPeerConnection();

    // Send ICE candidates
    pc.onicecandidate = ({ candidate }) => {
      if (candidate) socket.emit('ice-candidate', candidate);
    };

    // Get camera
    navigator.mediaDevices.getUserMedia({ video: true, audio: false })
      .then(stream => {
        document.getElementById('preview').srcObject = stream;
        stream.getTracks().forEach(track => pc.addTrack(track, stream));
        return pc.createOffer();
      })
      .then(offer => {
        pc.setLocalDescription(offer);
        socket.emit('offer', offer);
      });

    // Receive answer
    socket.on('answer', async answer => {
      await pc.setRemoteDescription(new RTCSessionDescription(answer));
    });

    // Receive ICE from dashboard
    socket.on('ice-candidate', async cand => {
      try { await pc.addIceCandidate(new RTCIceCandidate(cand)); } catch(e) {}
    });
  </script>
</body>
</html>
