<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Camera Sender</title>
</head>
<body>
  <h2>Camera Sender</h2>
  <button id="startBtn">Start Camera</button>
  <video id="localVideo" autoplay playsinline muted></video>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const pc = new RTCPeerConnection();

    // Show local video
    document.getElementById("startBtn").onclick = async () => {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });
      document.getElementById("localVideo").srcObject = stream;
      stream.getTracks().forEach(track => pc.addTrack(track, stream));

      const offer = await pc.createOffer();
      await pc.setLocalDescription(offer);
      socket.emit("offer", offer);
    };

    // ICE candidates from viewer
    socket.on("answer", async answer => {
      await pc.setRemoteDescription(new RTCSessionDescription(answer));
    });

    pc.onicecandidate = ({ candidate }) => {
      if (candidate) socket.emit("ice-candidate", candidate);
    };

    socket.on("ice-candidate", cand => {
      pc.addIceCandidate(new RTCIceCandidate(cand));
    });
  </script>
</body>
</html>
